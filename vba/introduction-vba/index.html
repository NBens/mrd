<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.2.4">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Chiu Yu Ko">

  
  
  
    
  
  <meta name="description" content="Learning Objectives:
 What is VBA? Why VBA? What is TikZ? Installation of LaTeX Hello world Basic setup of TikZ Demand and Supply Diagram  What is VBA? Why VBA? VBA stands for Visual Basic Application. It shares the same syntax as Basic language. Every operation you can perform in Excel using keyboard and mouse can be represented by VBA code. Hence, it allows a lot of flexibility and functionality when using Excel.">

  
  <link rel="alternate" hreflang="en-us" href="/vba/introduction-vba/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin="anonymous">
    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-7442008-8', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/vba/introduction-vba/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Chiu Yu Ko">
  <meta property="og:url" content="/vba/introduction-vba/">
  <meta property="og:title" content="Introduction to VBA | Chiu Yu Ko">
  <meta property="og:description" content="Learning Objectives:
 What is VBA? Why VBA? What is TikZ? Installation of LaTeX Hello world Basic setup of TikZ Demand and Supply Diagram  What is VBA? Why VBA? VBA stands for Visual Basic Application. It shares the same syntax as Basic language. Every operation you can perform in Excel using keyboard and mouse can be represented by VBA code. Hence, it allows a lot of flexibility and functionality when using Excel."><meta property="og:image" content="/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-05-04T00:00:00&#43;08:00">
  
  <meta property="article:modified_time" content="2019-05-04T00:00:00&#43;08:00">
  

  

  

  <title>Introduction to VBA | Chiu Yu Ko</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Chiu Yu Ko</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/files/cv.pdf">
            
            <span>CV</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#featured">
            
            <span>Publication</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#workingpaper">
            
            <span>Working Paper</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#book">
            
            <span>Book</span>
            
          </a>
        </li>

        
        

        

        
        
        

        <li class="nav-item">
          <a class="nav-link" href="/r/">
            
            <span>R</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/tikz/">
            
            <span>TikZ</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/vba/">
            
            <span>VBA</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/others/">
            
            <span>Others</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>



<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" id="search-query" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/vba/">VBA</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/vba/"></a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/vba/introduction-excel/">Tutorial</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/vba/introduction-excel/">Introduction to Excel</a>
      </li>
      
      <li >
        <a href="/vba/basic-vba/">Introduction to VBA</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
      <p class="docs-toc-title">On this page</p>
      

      <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#what-is-vba-why-vba">What is VBA? Why VBA?</a></li>
</ul></li>
<li><a href="#vba-basics">VBA Basics</a>
<ul>
<li><a href="#visual-basic-editor">Visual Basic Editor</a></li>
<li><a href="#hello-world">Hello World</a></li>
<li><a href="#variable">Variable</a></li>
<li><a href="#subroutine-and-function">Subroutine and Function</a></li>
</ul></li>
<li><a href="#objects">Objects</a>
<ul>
<li><a href="#cells">Cells</a></li>
<li><a href="#range">Range</a></li>
<li><a href="#worksheets">Worksheets</a></li>
<li><a href="#workbook">Workbook</a></li>
<li><a href="#application">Application</a></li>
<li><a href="#active-objects">Active Objects</a></li>
<li><a href="#with">With</a></li>
</ul></li>
<li><a href="#charting">Charting</a>
<ul>
<li><a href="#chart-sheet">Chart Sheet</a></li>
<li><a href="#embedded-chart">Embedded Chart</a></li>
<li><a href="#chart-type">Chart Type</a></li>
<li><a href="#data-series">Data Series</a></li>
</ul></li>
<li><a href="#record-macro">Record Macro</a></li>
<li><a href="#macro-enable-file">Macro-enable File</a></li>
<li><a href="#programming">Programming</a></li>
<li><a href="#conditionals">Conditionals</a>
<ul>
<li><a href="#relational-operator">Relational Operator</a></li>
<li><a href="#if">If</a></li>
<li><a href="#if-else">If-else</a></li>
<li><a href="#if-elseif-else">If-elseif-else</a></li>
<li><a href="#select-case">Select Case</a></li>
<li><a href="#logical-operators">Logical Operators</a></li>
<li><a href="#example-sma">Example: SMA</a></li>
<li><a href="#example-sma-trading-rule">Example: SMA Trading Rule</a></li>
</ul></li>
<li><a href="#iteration">Iteration</a>
<ul>
<li><a href="#while-loop">While Loop</a></li>
<li><a href="#for-loop">For Loop</a></li>
<li><a href="#for-each-loop">For each Loop</a></li>
<li><a href="#example-relative-strength-index">Example: Relative Strength Index</a></li>
</ul></li>
</ul>
</nav>

      <ul class="nav toc-top">
        <li><a href="#">Back to top</a></li>
      </ul>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article" itemscope itemtype="http://schema.org/Article">

        <div class="docs-article-container">
          <h1 itemprop="name">Introduction to VBA</h1>

          <div class="article-style" itemprop="articleBody">
            

<p>Learning Objectives:</p>

<ul>
<li>What is VBA? Why VBA?</li>
<li>What is TikZ?</li>
<li>Installation of LaTeX</li>
<li>Hello world</li>
<li>Basic setup of TikZ</li>
<li>Demand and Supply Diagram</li>
</ul>

<h2 id="what-is-vba-why-vba">What is VBA? Why VBA?</h2>

<p>VBA stands for Visual Basic Application. It shares the same syntax as Basic language. Every operation you can perform in Excel using keyboard and mouse can be represented by VBA code. Hence, it allows a lot of flexibility and functionality when using Excel.</p>

<p>VBA improves your logical thinking skills, and prepares you for other programming languages, since it is quite basic and the thinking processes can be applied to other languages (such as R in the next chapter). It is ideal for repetitive tasks (e.g. code a function that will run the same process each time, instead of typing it out manually)</p>

<h1 id="vba-basics">VBA Basics</h1>

<h2 id="visual-basic-editor">Visual Basic Editor</h2>

<p>First, we need to open Visual Basic Editor (VBE). There are two ways to open VBE: (1) Press <strong>ALT+F11</strong> to open the Visual Basic Editor and (2)  File &gt; Options &gt; Customize Ribbon &gt; Developer(check the box) Developer Tab &gt; Visual Basic</p>




  

<figure>

<img src="/img/Excel/VBA_Interface1.png" />


</figure>

<p>In the toolbar, select Insert \textgreater Module. Make sure you insert the module into the workbook that you are working on.</p>




  

<figure>

<img src="/img/Excel/VBA_InsertModule.png" />


</figure>

<p>Module is the place where you store the code. You can have as many modules as you want. You can put your code into different modules according to the functions they perform.</p>

<h2 id="hello-world">Hello World</h2>

<p>We will use MsgBox function in VBA to create a popup window in Excel to say hello world.</p>

<pre><code>Sub HelloWorld()
     MsgBox (&quot;Hello World! I like VBA!&quot;)
End Sub
</code></pre>




  

<figure>

<img src="/img/Excel/VBA_HelloWorld.png" />


</figure>

<h2 id="variable">Variable</h2>

<p><code>Dim</code> is used to define variables. The syntax looks like this:</p>

<pre><code>Dim a As Integer
Dim b As Double
</code></pre>

<table>
<thead>
<tr>
<th>Variable</th>
<th>Range</th>
</tr>
</thead>

<tbody>
<tr>
<td>Integer</td>
<td>From –32,768 to 32,767</td>
</tr>

<tr>
<td>Long</td>
<td>From –2,147,483,648 to 2,147,486,647</td>
</tr>

<tr>
<td>Single</td>
<td>From –3402823E38 to –1.401298E–45 or 1.401298E–45 to 3.402823E38</td>
</tr>

<tr>
<td>Double</td>
<td>From –1.79769313486232E308 to –4.94065645841247E–324  or 1.79769313486232E308 to 4.94065645841247E–324</td>
</tr>

<tr>
<td>Boolean</td>
<td>Either 1 or 0</td>
</tr>

<tr>
<td>String</td>
<td>1 to 65,400 characters</td>
</tr>

<tr>
<td>Array</td>
<td>An array is a group of variables</td>
</tr>

<tr>
<td>Variant</td>
<td>Anything</td>
</tr>
</tbody>
</table>

<p>The following example display the value of variable.</p>

<pre><code>Sub DisplayVar()
Dim a as Integer
    a = 10
    Msgbox(&quot;My variable has the value of &quot; &amp; a &amp;&quot;.&quot;)
End Sub
</code></pre>

<p>One useful function of MsgBox is to check if certain sections of your code are running properly.</p>

<h2 id="subroutine-and-function">Subroutine and Function</h2>

<p>In terms of the code that you can program inside, a <code>Function</code> and a <code>Sub</code> are similar. The main difference is that a Sub performs a task, but returns no output, while a Function takes in input and returns output.</p>

<p>Our Hello World is an example of Sub. The structure of sub is that it starts with <code>Sub</code> together with the name of the Sub, and it ends with <code>End Sub</code>. The code to run is in between.</p>

<pre><code>Sub Name()
        ---Task 1---
        ---Task 2---
End Sub
</code></pre>

<p>Inside a subroutine, we can call other subroutine. The following subroutine calls HelloWorld subroutine twice.</p>

<pre><code>Sub CallAnotherSub()
    Call HelloWorld
    Call HelloWorld
End Sub
</code></pre>

<p>The syntax for a function is similar. The structure of function is that it starts with <code>Function</code> together with the name of the Sub, and it ends with <code>End Function</code>. The code to run is in between.</p>

<p>However, two key differences: (1) we have to enter the variable to be processed and its variable type, and (2) we have to tell what is the output of the function.</p>

<pre><code>Function Name( Variable As Variable Type)
    ---Content here---
    Name = .....
End Function
</code></pre>

<p>Let us create a simple function that calculate length hypotenuse of a right-angle triangle. To calculate the length hypotenuse, we need to have lengths of the sides. Hence, since sides are number, we use double. Since the formula is square root of sum of squared length of the sides, we will use <code>^</code> as power and <code>Sqr</code> as square root function.</p>

<pre><code>Function Hypotenuse(a As Double, b As Double)
    Hypotenuse = Sqr(a ^ 2 + b ^ 2)
End Function
</code></pre>

<p>Go to spreadsheet then type <code>=Hypotenus(3,4)</code> into formula of any cell. You should get 5.</p>

<p>We can also call function inside a subroutine. The following subroutine calls the hypotenus function.</p>

<pre><code>Sub MsgFunction()
    Msgbox(&quot;Secret is &quot; &amp; ABC(3,4))
End Sub
</code></pre>

<p>Recall the spreadsheet example of calculation of EMA. S</p>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>n</td>
<td>5</td>
<td></td>
</tr>

<tr>
<td>2</td>
<td>beta</td>
<td><code>=2/(A1+1)</code></td>
<td></td>
</tr>

<tr>
<td>3</td>
<td>Date</td>
<td>Price</td>
<td>EMA(n)</td>
</tr>

<tr>
<td>4</td>
<td>02-May-16</td>
<td>10</td>
<td></td>
</tr>

<tr>
<td>&hellip;</td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>8</td>
<td>06-May-16</td>
<td>8</td>
<td><code>=AVERAGE(B4:B8)</code></td>
</tr>

<tr>
<td>9</td>
<td>07-May-16</td>
<td></td>
<td><code>=$B$2*B9+(1-$B$2)*C8</code></td>
</tr>
</tbody>
</table>

<pre><code>Function EMA(EMAYes As Double, price As Double, n As Integer)
    beta = 2 / (n + 1)
    EMA = beta * price + (1 - beta) * EMAYes
End Function
</code></pre>

<p>We can simplify our spreadsheet using the VBA code as shown below.</p>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>n</td>
<td>5</td>
<td></td>
</tr>

<tr>
<td>2</td>
<td>beta</td>
<td><code>=2/(A1+1)</code></td>
<td></td>
</tr>

<tr>
<td>3</td>
<td>Date</td>
<td>Price</td>
<td>EMA(n)</td>
</tr>

<tr>
<td>4</td>
<td>02-May-16</td>
<td>10</td>
<td></td>
</tr>

<tr>
<td>&hellip;</td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>8</td>
<td>06-May-16</td>
<td>8</td>
<td><code>=AVERAGE(B4:B8)</code></td>
</tr>

<tr>
<td>9</td>
<td>07-May-16</td>
<td></td>
<td><code>=EMA(C7,B8,$B$1)</code></td>
</tr>
</tbody>
</table>

<h1 id="objects">Objects</h1>

<p>Objects are special type of variables. In particular, they represent elements of Excel. Common used objects include</p>

<ol>
<li>cell,</li>
<li>range,</li>
<li>workbook,</li>
<li>worksheet,</li>
<li>active objects,</li>
<li>application and</li>
<li>chart.</li>
</ol>

<p>To use object, we can use either method or property.
<strong>Method</strong> is an action: activate, select, delete, value, formula, text, clear, copy, paste.</p>

<p><strong>Property</strong> is description: name, visible
Using a metaphor: If object is noun, method is verb and property is adjective</p>

<p><strong>Collections</strong> is an object that contain a group of the same object. For example, <code>Worksheets</code> contains all worksheet objects, and <code>Workbooks</code> contains all workbook objects. To call a particular worksheet, we would call the name of the particular sheet in Worksheets.</p>

<h2 id="cells">Cells</h2>

<p>Cells refers to one cell in a range but it is using coordinate instead of R1C1 as cell reference. The syntax is <code>Cells(row, column)</code>.</p>

<p>For example, the following sets the second row in the range C2:C5 to value of 3. In the other words, C3 is set to 3.</p>

<pre><code>Sub RangeAndCell()
Range(&quot;C2:C5&quot;).Cells(2, 1).Value = 3
End Sub
</code></pre>

<p>If the worksheet name is not explicitly stated, it is assumed that the code works on the active sheet.</p>

<pre><code>Sub WorkingOnCell()
Cells(1,1).value = 5
End Sub
</code></pre>

<p>Offset refers to another cell, taking reference from the current active cell.</p>

<pre><code>Sub CellOffSet()
Cells(1,1) = 5
Cells(1,1).Offset(0,1).Formula = &quot;=A1+1&quot;
Cells(1,1).Offset(1,0).Formula = &quot;=A1+2&quot;
End Sub
</code></pre>

<p>Then cell A1 is 5, cell B1 is 6 and cell A2 is 7</p>

<h2 id="range">Range</h2>

<p>Range is a collection of cells.</p>

<pre><code>Sub SheetAndRange()
Worksheets(&quot;sheet1&quot;).Range(&quot;A1&quot;).Value = 3
End Sub
</code></pre>

<p>This causes the worksheet named sheet1 to have the value 3 in cell A1. If the worksheet name is not explicitly stated, it is assumed that the code works on the active sheet.</p>

<p>The following code shows the formula, value, text property of range.</p>

<pre><code>Sub WorkingOnRange()
Range(&quot;A1&quot;).Formula = &quot;=RAND()&quot;
Range(&quot;B1:E3&quot;).Value = 6
Range(&quot;A1&quot;).Text=&quot;3+4&quot;
End Sub
</code></pre>

<p>The following code shows how to do copy, paste and paste special (value).</p>

<pre><code>Sub CopyAndPaste()
Range(&quot;A1:B5&quot;).Formula = &quot;=RAND()&quot;
Range(&quot;C1&quot;).Formula = &quot;=A1+B1&quot;
Range(&quot;C1&quot;).Copy 
Range(&quot;C2:C5&quot;).PasteSpecial
End Sub
</code></pre>

<p>The following code shows how to obtain input from the spreadsheet.</p>

<pre><code>Sub GetFromSheet ()
Dim a as Integer
Range(&quot;A1&quot;).Formula =&quot;=RANDBETWEEN(1,6)&quot;
a = Range(&quot;A1&quot;).Value
Msgbox(a)
End Sub
</code></pre>

<h2 id="worksheets">Worksheets</h2>

<p>Worksheets are what we use in Excel, we can create multiple sheets and give them unique names etc. We can also add new sheets or delete sheets in our VBA code.</p>

<pre><code>Sub AddSheet()
   WorkSheets.Add
   WorkSheets(ActiveSheet.Name).Name = &quot;MySheet&quot;
End Sub

Sub DelSheet()
   Application.DisplayAlerts = False
   WorkSheets(&quot;MySheet&quot;).Delete
   Application.DisplayAlerts = True
End Sub
</code></pre>

<p>We can also activate, rename or hide/unhide worksheets:</p>

<pre><code>Worksheets(&quot;sheet1&quot;).Activate
Worksheets(&quot;sheet1&quot;).Delete
Worksheets(&quot;sheet2&quot;).Select
Worksheets(&quot;sheet1&quot;).Name=&quot;Me&quot;
Worksheets(&quot;sheet3&quot;).Visible=False
Worksheets.Add
</code></pre>

<h2 id="workbook">Workbook</h2>

<p>Workbook object is essentially one excel file.</p>

<pre><code>Sub WorkBookActiveName()
Workbooks(&quot;book1&quot;).Activate
MsgBox (Workbooks(&quot;book1&quot;).ActiveSheet.Name)
End Sub
</code></pre>

<h2 id="application">Application</h2>

<p>The following four lines show how to select using application objects. The first line chooses cell A1 in the active 2. The second line chooses the second column (of the active worksheet). The third line chooses the first row (of the active worksheet). The forth line chooses the worksheet with name <code>sheet1</code>.</p>

<pre><code>Application.ActiveSheet.Cells(1,1).Select
Application.Columns(2).Select
Application.Rows(1).Select
Application.Sheets(&quot;sheet1&quot;).Select
</code></pre>

<p>The following shows some actions in spreadsheet. The first line asks the program to redo all calculation for the spreadsheet. The second line perform <code>redo</code>.</p>

<pre><code>Application.Calculate
Application.Undo
</code></pre>

<p>Worksheet functions are application objects. They can be used directly. For example, the following three lines of code corresponds to calling <code>COUNT</code>, <code>SUM</code> and <code>AVERAGE</code> functions from the spreadsheet.</p>

<pre><code>Application.WorksheetFunction.Count
Application.WorksheetFunction.Sum
Application.WorksheetFunction.Average
</code></pre>

<p>Note that <code>Application.</code> can be omitted. The following function SumAvg that calculates sum of two averages of two input ranges.</p>

<pre><code>Function SumAvg(X as Range, Y as Range)
Dim xavg As Double
Dim yavg As Double
xavg = WorksheetFunction.Average(X)
yavg = WorksheetFunction.Average(Y)
SumAvg = xavg + yavg
End Function
</code></pre>

<h2 id="active-objects">Active Objects</h2>

<p>ActiveCell refers to the currently selected cell in your Excel workbook. From there, you can add or delete data from the cell. For example,</p>

<pre><code>Sub WorkingActiveCell()
   ActiveCell.Delete
   ActiveCell.Value = 11
   ActiveCell.text = &quot;Helloworld&quot;
End Sub
</code></pre>

<p>The final value in the ActiveCell will be Helloworld. This is because you first deleted whatever was in the cell, then put the value 11 into the cell. After which, you overrode the previous value and put in the word Helloworld into the active cell.</p>

<p>The following shows how to display property of active objects. The first line display a message box that tells the address of the active cell, the second one tells the name of active worksheet, and the second line tells the name of the active workbook (the current file name).</p>

<pre><code>MsgBox (ActiveCell.Address)
MsgBox (ActiveSheet.Name)
MsgBox (ActiveWorkbook.Name)
</code></pre>

<h2 id="with">With</h2>

<p>Using a With statement allows you to code more efficiently, especially if you have to keep referring to the same object. The following example shows different properties are set for the cells(1,1).</p>

<pre><code>Sub WithExample()
With Cells(1, 1)
    .Value = 4
    .Interior.Color = RGB(255, 255, 0)
    .Font.Color = RGB(0, 255, 0)
End With
End Sub
</code></pre>

<p>The code within the With and End With part is applied to the specified cell, which in this case is Cells(1,1).</p>

<h1 id="charting">Charting</h1>

<p>For charting in Excel, there are two methods:</p>

<ol>
<li>chart sheet and</li>
<li>embedded chart.</li>
</ol>

<h2 id="chart-sheet">Chart Sheet</h2>

<p>Chart sheet is a worksheet that only has chart. It is an object in a workbook.</p>

<p>To create a new chart sheet, we use the command <code>Charts.Add</code>. Note that this is similar to adding new worksheet command <code>Worksheets.Add</code>.</p>

<p>Then we need to define data source using <code>.SetSourceData Source:=</code>.</p>

<p>Finally, we need to tell what kind of chart is plotting <code>.ChartType =</code>. For example, line chart is <code>xlLine</code></p>

<pre><code>Sub NewLineChartSheet()
Dim ChartSheet As Chart
Dim Data As Range
Set ChartSheet = Charts.Add
Set Data = Sheets(&quot;Sheet1&quot;).Range(&quot;A1:B3&quot;)
With ChartSheet
    .SetSourceData Source:=Data
    .ChartType = xlLine
End With
End Sub
</code></pre>

<p>It is useful to define a chart with name so that we can refer later.</p>

<pre><code>Sub NewNamedChartSheet()
Dim ChartSheet As Chart
Dim Data As Range
Set ChartSheet = Charts.Add
Set Data = Sheets(&quot;Sheet1&quot;).Range(&quot;A1:B30&quot;)
With ChartSheet
    .SetSourceData Source:=Data
    .ChartType = xlLine
    .Name = &quot;mychart&quot;
End With
End Sub
</code></pre>

<p>The following code changes a property of an existing chartsheet. The following code changes the chart by including additional data.</p>

<pre><code>Sub ChangeChartSheet()
Dim ChartSheet As Chart
Dim Data As Range
Set ChartSheet = Charts(&quot;mychart&quot;)
Set Data = Sheets(&quot;Sheet1&quot;).Range(&quot;A1:B50&quot;)
With ChartSheet
    .SetSourceData Source:=Data
End With
End Sub
</code></pre>

<h2 id="embedded-chart">Embedded Chart</h2>

<p>For the chart to be included in a worksheet, we use <code>ChartObjects.Add</code> instead.</p>

<p>We need to tell which worksheet to place the diagram and the distance from the top and left of spreadsheet as well as width and height</p>

<pre><code>Sub EmbeddedChart()
Dim mychart As Object
Dim Data As Range
Set mychart = Sheets(&quot;Sheet1&quot;).ChartObjects.Add(Left:=300, Width:=300, Top:=10, Height:=300)
Set Data = Sheets(&quot;Sheet1&quot;).Range(&quot;A1:B3&quot;)
With mychart.Chart
    .ChartType = xlLine
    .SetSourceData Source:=Data
End With
End Sub
</code></pre>

<p>We can give name to the object but not the chart.</p>

<pre><code>Sub EmbeddedNameChart()
Dim mychart As Object
Dim Data As Range
Set mychart = Sheets(&quot;Sheet1&quot;).ChartObjects.Add(Left:=300, Width:=300, Top:=10, Height:=300)
Sheets(&quot;Sheet1&quot;).ChartObjects(1).Name = &quot;mychart&quot;
Set Data = Sheets(&quot;Sheet1&quot;).Range(&quot;A1:B3&quot;)
With mychart.Chart
    .ChartType = xlLine
    .SetSourceData Source:=Data
End With
End Sub
</code></pre>

<p>The following code changes a property of an existing embedded chart. The following code changes the chart by including additional data.</p>

<pre><code>Sub ChangeEmbeddedChart()
Dim ChartObj As Object
Set ChartObj = Sheets(&quot;Sheet1&quot;).ChartObjects(&quot;Hello&quot;)
With ChartObj.Chart
    .SetSourceData Source:=Sheets(&quot;Sheet1&quot;).Range(&quot;A1:D3&quot;)
End With
End Sub
</code></pre>

<h2 id="chart-type">Chart Type</h2>

<p>Besides line chart, there are many different types of chart. Here are the common types.</p>

<table>
<thead>
<tr>
<th>Function</th>
<th>Chart Type</th>
</tr>
</thead>

<tbody>
<tr>
<td>xlLine</td>
<td>line chart</td>
</tr>

<tr>
<td>xlColumnClustered</td>
<td>Clustered Column (vertical bar chart)</td>
</tr>

<tr>
<td>xlBarClustered</td>
<td>Clustered bar (horizontal bar chart)</td>
</tr>

<tr>
<td>xlPie</td>
<td>Pie</td>
</tr>

<tr>
<td>xlArea</td>
<td>Area chart (line chart but colored area)</td>
</tr>

<tr>
<td>xlXYScatter</td>
<td>Scatter</td>
</tr>

<tr>
<td>xlRadar</td>
<td>Radar</td>
</tr>

<tr>
<td>xlStockHLC</td>
<td>High-Low-Close</td>
</tr>

<tr>
<td>xlStockOHLC</td>
<td>Open-High-Low-Close (Candle Stick)</td>
</tr>

<tr>
<td>xlStockVHLC</td>
<td>Volume-High-Low-Close</td>
</tr>

<tr>
<td>xlStockVOHLC</td>
<td>Volume-Open-High-Low-Close</td>
</tr>
</tbody>
</table>

<h2 id="data-series">Data Series</h2>

<p>To allow for multiple graphics to be plotted, we need to use <code>seriescollection</code>.</p>

<p>First, to add a new data, we need to say <code>.SeriesCollection.NewSeries</code>. Then, we can define the name, XValues (x) and Values (y).</p>

<pre><code>Sub NewChartSheetMultiple()
Dim ChartSheet As Chart
Dim Time, Data1, Data2 As Range
Set ChartSheet = Charts.Add
Set Time = Sheets(&quot;Sheet1&quot;).Range(&quot;A1:A5&quot;)
Set Data1 = Sheets(&quot;Sheet1&quot;).Range(&quot;B1:B5&quot;)
Set Data2 = Sheets(&quot;Sheet1&quot;).Range(&quot;C1:C5&quot;)
With ChartSheet
    .ChartType = xlLine
    
    .SeriesCollection.NewSeries
    .SeriesCollection(1).Name = &quot;Stock 1&quot;
    .SeriesCollection(1).XValues = Time
    .SeriesCollection(1).Values = Data1
    
    .SeriesCollection.NewSeries
    .SeriesCollection(2).Name = &quot;Stock 2&quot;
    .SeriesCollection(2).XValues = Time
    .SeriesCollection(2).Values = Data2
End With
End Sub
</code></pre>

<h1 id="record-macro">Record Macro</h1>

<p>Lastly, to see how to code certain actions in Excel, VBA has this useful function called Record Macro.
To access it, in the Developer Tab, press the Record Macro button.</p>




  

<figure>

<img src="/img/Excel/VBA_RecordMacro.png" />


</figure>

<p>Whatever you do in Excel from then on will be recorded in a macro, which you can later access. To stop recording, click the button again, which should now say Stop Recording.
Click on the Visual Basic button (access to VBE) to see your recorded actions in code. This is useful if you know what you want to code, and how to do it in Excel, but you do not know how to code it in VBA.</p>

<h1 id="macro-enable-file">Macro-enable File</h1>

<p>Note that when you save your Excel file, always save it in <strong>xlsm</strong> format (macro enabled worksheet format), otherwise you will not be able to run your macros when you open the file next time!</p>




  

<figure>

<img src="/img/Excel/VBA_savexlam.png" />


</figure>

<h1 id="programming">Programming</h1>

<p>In this chapter, we learn conditional and iterations.</p>

<h1 id="conditionals">Conditionals</h1>

<p>There are 4 main types of conditionals that we will use in VBA:</p>

<ol>
<li>If,</li>
<li>If-else,</li>
<li>If-ElseIf-else, and</li>
<li>Select Case.</li>
</ol>

<h2 id="relational-operator">Relational Operator</h2>

<p>Conditional statement are executed based on logical statement (true/false). The most basic logical statement is by relational operators. VBA uses the same relational operator as those in Excel spreadsheet.</p>

<table>
<thead>
<tr>
<th>Operator</th>
<th>Meaning</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>&gt;</code></td>
<td>greater than</td>
</tr>

<tr>
<td><code>&lt;</code></td>
<td>less than</td>
</tr>

<tr>
<td><code>=</code></td>
<td>equal to</td>
</tr>

<tr>
<td><code>&gt;=</code></td>
<td>greater than or equal to</td>
</tr>

<tr>
<td><code>&lt;=</code></td>
<td>less than or equal to</td>
</tr>
</tbody>
</table>

<h2 id="if">If</h2>

<p>How do conditionals work? They are usually put at the front of a condition that you want to be met. If that condition is met, then Excel will carry out the specified action or task. The syntax looks like this:</p>

<pre><code>If (condition is True) Then
   Do action/task 
End if
</code></pre>

<p>Here is an example for if-statement using subroutine.</p>

<pre><code>Sub SimpleIF()
Dim a as Integer 
Dim b as Integer 
   a = 2
   b = 1
   If a &gt; b Then
      MsgBox( &quot;I like this class!&quot; )
   End If
   If a &lt; b Then
      MsgBox( &quot;I hate this class!&quot; )
   End If
End Sub
</code></pre>




  

<figure>

<img src="/img/Excel/VBA_if.png" />


</figure>

<p>Here is an example for if-statement using function.</p>

<p>For a list of scores: 85, 90, 72, 45…, we want to assign <strong>Pass</strong> if no less than 50, and <strong>Fail</strong> otherwise.</p>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Student</td>
<td>Score</td>
<td>Pass?</td>
</tr>

<tr>
<td>2</td>
<td>Peter</td>
<td>85</td>
<td><code>=IF(B2&gt;50,&quot;PASS&quot;,&quot;FAIL&quot;)</code></td>
</tr>

<tr>
<td>3</td>
<td>John</td>
<td>94</td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>Mary</td>
<td>72</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>Susuan</td>
<td>45</td>
<td></td>
</tr>
</tbody>
</table>

<p>We can write the following function.</p>

<pre><code>Function Pass1(Mark As Integer)
If Mark &gt;= 50 Then
   Pass1 = &quot;Pass&quot;
End If
If Mark &lt; 50 Then
   Pass1 = &quot;Fail&quot;
End If
End Function
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Student</td>
<td>Score</td>
<td>Pass?</td>
</tr>

<tr>
<td>2</td>
<td>Peter</td>
<td>85</td>
<td><code>=Pass1(B2)</code></td>
</tr>

<tr>
<td>3</td>
<td>John</td>
<td>94</td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>Mary</td>
<td>72</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>Susuan</td>
<td>45</td>
<td></td>
</tr>
</tbody>
</table>

<h2 id="if-else">If-else</h2>

<p>We sometimes have a binary situation that we want to execute task A if condition is true and otherwise task B. We can use the following if-else statement.</p>

<pre><code>If (condition is True) Then
   Do action/task A
Else
   Do action/task B
End if
</code></pre>

<p>In this example, if the 1st condition is met, task A will be carried out. Otherwise, we immediately carry out task B, because no other conditions are specified.</p>

<p>Here is an example of routine for if-statement.</p>

<pre><code>Sub IFElse()
Dim a as Integer 
Dim b as Integer 
   a = 2
   b = 1
   If a = b Then
      MsgBox( &quot;I like this module!&quot; )
   Else 
      MsgBox( &quot;I hate this module!&quot; )
   End If
End Sub
</code></pre>




  

<figure>

<img src="/img/Excel/VBA_ifelse.png" />


</figure>

<p>Here, we are using 2 If conditions. Also note that the code only accounts for the case a &gt; b, and the case a&lt;b. If a=b, then you will not get any result. This is extremely important, because when coding people often tend to neglect one or two cases, and this causes problems in their code. Also note that every If chunk must be ended with the code End If, otherwise VBA will not know that you have ended the If code chunk.</p>

<p>Continue with our Pass1, we can use if-else statement.</p>

<pre><code>Function Pass2(Mark As Integer)
If Mark &gt;= 50 Then
   Pass2 = &quot;Pass&quot;
Else
   Pass2 = &quot;Fail&quot;
End If
End Function
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Student</td>
<td>Score</td>
<td>Pass?</td>
</tr>

<tr>
<td>2</td>
<td>Peter</td>
<td>85</td>
<td><code>=Pass2(B2)</code></td>
</tr>

<tr>
<td>3</td>
<td>John</td>
<td>94</td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>Mary</td>
<td>72</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>Susuan</td>
<td>45</td>
<td></td>
</tr>
</tbody>
</table>

<h2 id="if-elseif-else">If-elseif-else</h2>

<p>The next question would then be, what if we wanted to include another condition? We would then make use of the If-ElseIf-else conditional, as shown below.</p>

<pre><code>If (condition1 is True) Then 
   Do action/task A
ElseIf (condition2 is True) Then
   Do action/task B
Else
   Do action/task C
End if 
</code></pre>

<p>Note that If-ElseIf-Else conditionals are only evaluated once, in order. The topmost condition is checked, if that isn’t true, the next one is checked, and so on, until you find one that is true and perform that task. Whatever other conditions remaining below the true one are not gone through, because once that true condition’s task has been carried out, the checking stops. In other words, VBA will exit that If-ElseIf-Else chunk. For correctness, none of your conditions should have identical overlapping parts!</p>

<p>Here we use a If-Else condition, and now the a=b case is also accounted for, under the Else condition.</p>

<pre><code>Sub IFElseIF()
Dim a as Integer 
Dim b as Integer 
   a = 2
   b = 1
   If a = b Then
      MsgBox( &quot;I like this module!&quot; )
   ElseIf a &lt; b Then
      MsgBox( &quot;I hate this module!&quot; )
   Else
      MsgBox( &quot;I am neutral towards this module!&quot; )
   End If
End Sub
</code></pre>




  

<figure>

<img src="/img/Excel/VBA_ifelseifelse.png" />


</figure>

<p>Here, we have used an ElseIf condition, and this separates the previous <code>a&lt;b</code> and <code>a=b</code> cases into 2 different cases now. Previously in <code>confession1()</code> they were lumped together under the <code>Else</code> condition.</p>

<p>Recall our grading function as follows:</p>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Student</td>
<td>Score</td>
<td>Pass?</td>
</tr>

<tr>
<td>2</td>
<td>Peter</td>
<td>85</td>
<td><code>=IF(B2&gt;80,&quot;A&quot;,IF(B2&gt;70,&quot;B&quot;,&quot;C&quot;))</code></td>
</tr>

<tr>
<td>3</td>
<td>John</td>
<td>94</td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>Mary</td>
<td>72</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>Susuan</td>
<td>45</td>
<td></td>
</tr>
</tbody>
</table>

<pre><code>Function Grade1(Mark As Integer)
If Mark &gt;= 80 Then
   Grade1 = &quot;A&quot;
Elseif Mark &gt;= 70 Then
   Grade1 = &quot;B&quot;
Else
   Grade1 = &quot;C&quot;
End If
End Sub
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Student</td>
<td>Score</td>
<td>Pass?</td>
</tr>

<tr>
<td>2</td>
<td>Peter</td>
<td>85</td>
<td><code>=Grade1(B2)</code></td>
</tr>

<tr>
<td>3</td>
<td>John</td>
<td>94</td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>Mary</td>
<td>72</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>Susuan</td>
<td>45</td>
<td></td>
</tr>
</tbody>
</table>

<h2 id="select-case">Select Case</h2>

<p>How to handle if we have many different cases? We can use the Select function, to create cases that we want to choose between.</p>

<pre><code>Sub SelectCase()
Dim a as Integer
   a = 1
   Select Case a
      Case 1 
         MsgBox (&quot;I like this module!&quot;)
      Case 2
         MsgBox (&quot;I hate this module!&quot;)
      Case 3
         MsgBox (&quot;I am neutral!&quot;)
   End Select
End Sub
</code></pre>

<p>In this case, since you have set the value of a to 1, the output will be  <code>I like this module</code>. If you were to change the value of <code>a</code> in the code, the corresponding case will then be selected. This is useful if you had a variable with multiple states or values that you might want to switch between.</p>




  

<figure>

<img src="/img/Excel/VBA_SelectCase.png" />


</figure>

<p>Select case can also accommodate cases using relational operator. To do so, we have to use <code>Is</code> to represent the variable, and <code>Else</code> to represent all residual cases.</p>

<p>The following function returns the grade of a class based on the mark. A student will get an A if the mark is no less than 80, B if the mark is no less than 70 and C otherwise.</p>

<pre><code>Function Grade2(Mark As Integer)
Select Case Mark
    Case Is &gt;= 80
        Grade2 = &quot;A&quot;
    Case Is &gt;= 70
         Grade2 = &quot;B&quot;
    Case Else
         Grade2 = &quot;C&quot;
End Select
End Function
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Student</td>
<td>Score</td>
<td>Pass?</td>
</tr>

<tr>
<td>2</td>
<td>Peter</td>
<td>85</td>
<td><code>=Grade2(B2)</code></td>
</tr>

<tr>
<td>3</td>
<td>John</td>
<td>94</td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>Mary</td>
<td>72</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>Susuan</td>
<td>45</td>
<td></td>
</tr>
</tbody>
</table>

<h2 id="logical-operators">Logical Operators</h2>

<p>Sometimes, we want to combine several logical statements. However, different from Excel spreadsheet, for <code>and</code> and <code>or</code> VBA uses logical operator instead of logical function.</p>

<table>
<thead>
<tr>
<th>Operator</th>
<th>Meaning</th>
</tr>
</thead>

<tbody>
<tr>
<td>logical1 AND logical2</td>
<td>Returns TRUE if both logicals are TRUE</td>
</tr>

<tr>
<td>logical1 OR logical2</td>
<td>Returns TRUE if any of the logicals are TRUE, and Returns FALSE only if all logicals are FALSE</td>
</tr>

<tr>
<td>NOT logical</td>
<td>Changes FALSE to TRUE, or TRUE to FALSE</td>
</tr>
</tbody>
</table>

<p>Recall our A+ grading example.</p>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Student</td>
<td>Test</td>
<td>Exam</td>
<td>Grade</td>
</tr>

<tr>
<td>2</td>
<td>Peter</td>
<td>30</td>
<td>55</td>
<td><code>=IF(AND(B2+C2&gt;80,C2&gt;60),&quot;A&quot;,IF(B2+C2&gt;80,&quot;A&quot;,IF(B2+C2&gt;70,&quot;B&quot;,&quot;C&quot;))</code></td>
</tr>

<tr>
<td>3</td>
<td>John</td>
<td>28</td>
<td>62</td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>Mary</td>
<td>22</td>
<td>40</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>Susuan</td>
<td>45</td>
<td>30</td>
<td></td>
</tr>
</tbody>
</table>

<pre><code>Function AplusGrade(Test As Integer, Exam As Integer)
Dim Total As Integer
Total = Test + Exam
If Total &gt;= 80 And Exam &gt; 60 Then
AplusGrade = &quot;A+&quot;
Elseif Total  &gt;= 80 Then
AplusGrade = &quot;A&quot;
Elseif Total &gt;= 70 Then
AplusGrade= &quot;B&quot;
Else
AplusGrade = &quot;C&quot;
End If
End Function
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Student</td>
<td>Test</td>
<td>Exam</td>
<td>Grade</td>
</tr>

<tr>
<td>2</td>
<td>Peter</td>
<td>30</td>
<td>55</td>
<td><code>=APlusGrade(B2,C2)</code></td>
</tr>

<tr>
<td>3</td>
<td>John</td>
<td>28</td>
<td>62</td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>Mary</td>
<td>22</td>
<td>40</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>Susuan</td>
<td>45</td>
<td>30</td>
<td></td>
</tr>
</tbody>
</table>

<h2 id="example-sma">Example: SMA</h2>

<p>Recall that how we generate SMA as below</p>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>n</td>
<td>5</td>
<td></td>
</tr>

<tr>
<td>2</td>
<td>Date</td>
<td>Price</td>
<td>SMA(n)</td>
</tr>

<tr>
<td>3</td>
<td>02-May-16</td>
<td>10</td>
<td><code>=IF(COUNT($A$3:A3)&gt;=$B$1,average(Offset(B3,0,0,-$B1$)), &quot;&quot;)</code></td>
</tr>

<tr>
<td>4</td>
<td>03-May-16</td>
<td>9</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>04-May-16</td>
<td>8</td>
<td></td>
</tr>
</tbody>
</table>

<pre><code>Function SMA(Price As Range, n As Integer, Price0 As Range)
Dim day As Integer
day = WorksheetFunction.Count(Range(Price0,Price))
If day &gt;= n Then
SMA = WorksheetFunction.Average(Range(Price.Offset(-n+1,0),Price))
Else
SMA = &quot;&quot;
End If
End Function
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>n</td>
<td>5</td>
<td></td>
</tr>

<tr>
<td>2</td>
<td>Date</td>
<td>Price</td>
<td>SMA(n)</td>
</tr>

<tr>
<td>3</td>
<td>02-May-16</td>
<td>10</td>
<td><code>=SMA(B3,B$1,B$3)</code></td>
</tr>

<tr>
<td>4</td>
<td>03-May-16</td>
<td>9</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>04-May-16</td>
<td>8</td>
<td></td>
</tr>
</tbody>
</table>

<h2 id="example-sma-trading-rule">Example: SMA Trading Rule</h2>

<p>To generate a trading signal based on SMA, we can use the SMA function above.</p>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Delta</td>
<td>5</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>2</td>
<td>S</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>3</td>
<td>L</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>Date</td>
<td>Price</td>
<td>SMA(S)</td>
<td>SMA(L)</td>
<td>r</td>
<td>Trade</td>
</tr>

<tr>
<td>5</td>
<td>02-May-16</td>
<td>10</td>
<td><code>=SMA(B5,$B$2,$B$5)</code></td>
<td><code>=SMA(B5,$B$3,$B$5)</code></td>
<td><code>=C5/D5-1</code></td>
<td><code>=IF(E5&gt;=$B1$,1,IF(E5&lt;=-$B1$,-1,0))</code></td>
</tr>

<tr>
<td>6</td>
<td>03-May-16</td>
<td>9</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>7</td>
<td>04-May-16</td>
<td>8</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

<p><code>SMA(ST, LT, Delta, price, price0)</code> where price is current price, price0 is initial price, ST is the length of short term SMA, LT is the length of long term SMA, and Delta is threshold parameter.</p>

<p>This function assumes the prices are sorted chronologically. Then, using the SMA function above and finally calculate the trading signal using the if condition.</p>

<pre><code>Function SMATrade(ST As Integer, LT As Integer, Delta As Double, Price As Range, Price0 As Range)

Dim smas As Double
Dim smal As Double
Dim r As Double
Dim day As Integer

day = WorksheetFunction.Count(Range(Price0,Price))

If day &gt;= LT Then
  smaS = SMA(Price, ST, Price0)
  smaL = SMA(Price, LT, Price0)
  r = (smaS - smaL) / smaL

  If r &gt; Delta Then
     SMATrade = 1
  ElseIf r &lt; -Delta Then
     SMATrade = -1
  Else
     SMATrade= 0
  End If

End If
End Function

End Function
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Delta</td>
<td>5</td>
<td></td>
</tr>

<tr>
<td>2</td>
<td>S</td>
<td></td>
<td></td>
</tr>

<tr>
<td>3</td>
<td>L</td>
<td></td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>Date</td>
<td>Price</td>
<td>Trade</td>
</tr>

<tr>
<td>5</td>
<td>02-May-16</td>
<td>10</td>
<td><code>=SMATrade($B$2,$B$3,$B$1,B15,$B$5)</code></td>
</tr>

<tr>
<td>6</td>
<td>03-May-16</td>
<td>9</td>
<td></td>
</tr>

<tr>
<td>7</td>
<td>04-May-16</td>
<td>8</td>
<td></td>
</tr>
</tbody>
</table>

<h1 id="iteration">Iteration</h1>

<p>Sometimes, when coding certain things we want to check the same conditions multiple times. One way would be to write multiple If-Else chunks, but that would be extremely inefficient and tedious. We can use loops, such that we only need to type the If-Else chunk once and the loop will repeat it multiple times.
There are 2 types of loops, the while loop and the for loop. They work in a similar way, however you will use them under different circumstances, depending on what your code requires.</p>

<h2 id="while-loop">While Loop</h2>

<p>We first look at an example of a while loop.</p>

<pre><code>Sub WhileLoop()
Dim a As Integer
   a = 0
   Do While a &lt; 3
      MsgBox (a &amp; &quot;: I like this class! &quot;)
      a = a + 1
   Loop
   MsgBox (&quot;It is important so I said this &quot; &amp; a &amp; &quot; times!&quot;)
End Sub
</code></pre>

<p>Here, a has the initial value of 0. By the time the first loop is finished, a now has the value 1, because of the line <code>a = a + 1</code>, and the message box has appeared once with the message <code>I like this class!</code>. VBA then goes back to the top of the while loop, and checks if <code>a&lt;3</code>. Since <code>a=1</code>, this condition is satisfied, so the loop runs another iteration. Now <code>a=2</code>. Since the while condition is still satisfied, the loop runs a 3rd iteration. Now <code>a=3</code>. The condition <code>a&lt;3</code> is no longer true, so the loop does not continue running, and VBA exits the loop. We then expect to see a message box with the value <code>a=3</code> inside.</p>

<p>


  

<figure>

<img src="/img/Excel/VBA_DoLoop1.png" />


</figure>



  

<figure>

<img src="/img/Excel/VBA_DoLoop2.png" />


</figure>



  

<figure>

<img src="/img/Excel/VBA_DoLoop3.png" />


</figure>



  

<figure>

<img src="/img/Excel/VBA_DoLoop4.png" />


</figure></p>

<h2 id="for-loop">For Loop</h2>

<p>Another type of loop is the for loop. It works in a similar way to a while loop, but there will be occasions when it is more convenient to use a for loop instead of a while loop, and vice versa.</p>

<pre><code>Sub ForLoop()
    Dim a As Integer
    For a = 1 to 5 Step 1
        MsgBox (a &amp; &quot;: I like this class!&quot;)
     Next a
MsgBox (&quot;OK. I know. You have said this &quot; &amp; a-1 &amp; &quot; times!&quot;)
End Sub
</code></pre>

<p>Initially, <code>a=1</code>. Step 1 means that every time the loop completes one iteration, a will increase by 1. The increment happens when you reach the line <code>Next a</code>.
Once the for loop finishes running, a will have the value 5. Note that when the 5th iteration finishes running, a will have the value 6. Since 6 is not within the given range of the for loop, VBA exits the for loop. To get the correct number in the next message box, we use <code>a-1</code> instead of a.</p>

<p>


  

<figure>

<img src="/img/Excel/VBA_ForLoop1.png" />


</figure>



  

<figure>

<img src="/img/Excel/VBA_ForLoop2.png" />


</figure>



  

<figure>

<img src="/img/Excel/VBA_ForLoop3.png" />


</figure>



  

<figure>

<img src="/img/Excel/VBA_ForLoop4.png" />


</figure>



  

<figure>

<img src="/img/Excel/VBA_ForLoop5.png" />


</figure>



  

<figure>

<img src="/img/Excel/VBA_ForLoop6.png" />


</figure></p>

<p>In most cases, the task can be coded using either a for loop or a while loop. It depends on the situation, but using either usually has no difference, more of a preference issue.</p>

<h2 id="for-each-loop">For each Loop</h2>

<p>For collections, which are objects that contain a group of the same object, we can use the <code>For Each</code> method to iterate through the collection.</p>

<p>The following sub display the formula for each cells in the range A1:A3.</p>

<pre><code>Sub ForEachLoop()
Dim myCell as Range
   For Each myCell in Range(&quot;A1:A3&quot;)
      MsgBox myCell.Formula
   Next myCell
End Sub
</code></pre>

<p>The following functions returns the product of positive numbers within the range of cells. It will return 1 if none of the cells is positive.</p>

<pre><code>Function ProdPositive(Cells As Range)
ProdPositive = 1
For Each cell In Cells
   If cell.Value &gt; 0 Then
      ProdPositive = ProdPositive * cell.Value
   End If
Next cell
End Function
</code></pre>

<p>Another example is to remove all the charts in the activesheet.</p>

<pre><code>Sub RemoveAllChart()
Dim mycharts As ChartObject
For Each mycharts In ActiveSheet.ChartObjects
    mycharts.Delete
Next
End Sub
</code></pre>

<h2 id="example-relative-strength-index">Example: Relative Strength Index</h2>

<p>Here is a spreadsheet to calculate RSI.</p>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>n</td>
<td>14</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>2</td>
<td>Date</td>
<td>Price</td>
<td>U</td>
<td>D</td>
<td>RS</td>
<td>RSI</td>
</tr>

<tr>
<td>3</td>
<td>02-May-16</td>
<td>10</td>
<td><code>=IF(B4&gt;B3,1,0)</code></td>
<td><code>=IF(B4&lt;B3,1,0)</code></td>
<td><code>=IF(COUNT($A$4:A4)&gt;=$B$2,SUM(OFFSET(C4,0,0,-$B$1))/SUM(OFFSET(D4,0,0,-$B$1)),&quot;&quot;)</code></td>
<td><code>=100*E4/(1+E4)</code></td>
</tr>

<tr>
<td>4</td>
<td>03-May-16</td>
<td>9</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>04-May-16</td>
<td>8</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

<p>To show a more elaborate example of iteration, we go through the code for the Relative Strength Index(RSI) indicator.
We know that RSI only requires past price data.</p>

<p>Here we are setting Prices as an input, and telling VBA that this input should be a range. We then define <code>up</code>, <code>down</code> as long variables for up, down. We also define <code>RS</code> as double variable as relative strength. For calculation, we define <code>count</code> as a long variable and <code>day</code> as a range variable. After which, we assign the initial values of 0 to <code>up_day</code>, <code>down</code> and <code>count</code>.</p>

<pre><code>Function RSI(Prices As Range)
Dim up, down, count As Long
Dim RS As Double
Dim day As Range
   up = 0
   down= 0
   count = 1

   For Each day In Prices
     If count &gt; 1 Then
         If day.Value &gt; day.Offset(-1, 0).Value Then
           up = up+ 1
         ElseIf day.Value &lt; day.Offset(-1, 0).Value Then
           down = down + 1
         End If
      End if
      count = count + 1
   Next day
   
   If down &lt;&gt; 0 Then
     RS = up / down
     RSI = 100 * (RS / (1 + RS))
  else 
     RSI = 100
  End If
End Function
</code></pre>

<p>Here, the loop just runs through the data, and adds numbers to <code>up</code> and <code>down</code> accordingly. When the loop is done, we can then calculate RSI.</p>

<p>Now we see how this RSI function applies in spreadsheet as below.</p>

<table>
<thead>
<tr>
<th></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>n</td>
<td>14</td>
<td></td>
</tr>

<tr>
<td>2</td>
<td>Date</td>
<td>Price</td>
<td>RSI</td>
</tr>

<tr>
<td>3</td>
<td>02-May-16</td>
<td>10</td>
<td><code>=IF(COUNT($A$3:A3)&gt;=$B$1,RSI(OFFSET(B2,-$B$1-1,0))), &quot;&quot;)</code></td>
</tr>

<tr>
<td>4</td>
<td>03-May-16</td>
<td>9</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>04-May-16</td>
<td>8</td>
<td></td>
</tr>
</tbody>
</table>

          </div>

          

        </div>

        <div class="body-footer">
          Last updated on May 4, 2019
        </div>

      </article>

      <footer class="site-footer">
  
  <p class="powered-by">
    <a href="/privacy/">Privacy Policy</a>
  </p>
  

  <p class="powered-by">
    2019 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>

    

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin="anonymous"></script>
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.b82789348bc9b927834992b317787f39.js"></script>

  </body>
</html>


